<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipts Analytics Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1494.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.2.0/dist/amazon-cognito-identity.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="app-config.js"></script>
</head>
<body>
    <div class="container">
        <!-- Authentication Section -->
        <div id="auth-section" class="auth-section">
            <div class="auth-card">
                <div class="auth-header">
                    <div class="auth-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                    <h2>ðŸ“Š Receipts Analytics</h2>
                    <p class="auth-subtitle">Smart expense tracking & insights</p>
                </div>
                
                <div id="signup-view" class="auth-view">
                    <h3>Create Account</h3>
                    <div class="form-group">
                        <input type="email" id="signup-email" placeholder="Email" class="form-input">
                    </div>
                    <div class="form-group">
                        <input type="password" id="signup-password" placeholder="Password (min 8 characters)" class="form-input">
                    </div>
                    <div class="form-group">
                        <input type="text" id="signup-name" placeholder="Full Name" class="form-input">
                    </div>
                    <button onclick="signUp()" class="btn btn-primary">
                        <span class="btn-content">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="8.5" cy="7" r="4"></circle>
                                <line x1="20" y1="8" x2="20" y2="14"></line>
                                <line x1="23" y1="11" x2="17" y2="11"></line>
                            </svg>
                            Sign Up
                        </span>
                    </button>
                    <p class="auth-switch">
                        Already have an account? 
                        <a href="#" onclick="showSignIn()">Sign In</a>
                    </p>
                </div>

                <div id="signin-view" class="auth-view" style="display: none;">
                    <h3>Welcome Back</h3>
                    <div class="form-group">
                        <input type="email" id="signin-email" placeholder="Email" class="form-input">
                    </div>
                    <div class="form-group">
                        <input type="password" id="signin-password" placeholder="Password" class="form-input">
                    </div>
                    <button onclick="signIn()" class="btn btn-primary">
                        <span class="btn-content">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                                <polyline points="10 17 15 12 10 7"></polyline>
                                <line x1="15" y1="12" x2="3" y2="12"></line>
                            </svg>
                            Sign In
                        </span>
                    </button>
                    <p class="auth-switch">
                        Need an account? 
                        <a href="#" onclick="showSignUp()">Sign Up</a>
                    </p>
                </div>

                <div id="confirm-view" class="auth-view" style="display: none;">
                    <h3>Confirm Account</h3>
                    <p>Please check your email for the confirmation code</p>
                    <div class="form-group">
                        <input type="text" id="confirm-code" placeholder="Confirmation Code" class="form-input">
                    </div>
                    <div class="form-group">
                        <input type="email" id="confirm-email" placeholder="Email" class="form-input">
                    </div>
                    <button onclick="confirmSignUp()" class="btn btn-primary">Confirm</button>
                    <p class="auth-switch">
                        <a href="#" onclick="showSignIn()">Back to Sign In</a>
                    </p>
                </div>

                <div id="auth-message" class="message"></div>
            </div>
        </div>

        <!-- Main Application Section -->
        <div id="app-section" class="app-section" style="display: none;">
            <header class="app-header">
                <div class="header-left">
                    <h2>ðŸ“Š Receipts Analytics Dashboard</h2>
                    <div class="breadcrumb">
                        <span>Dashboard</span> / <span>Receipts Analytics</span>
                    </div>
                </div>
                <div class="user-info">
                    <div class="user-avatar">
                        <span id="user-initials">UN</span>
                    </div>
                    <div class="user-details">
                        <span id="user-name">User</span>
                        <span id="user-email"></span>
                    </div>
                    <button onclick="signOut()" class="btn btn-secondary btn-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Sign Out
                    </button>
                </div>
            </header>

            <div class="dashboard">
                <!-- Top Summary Cards -->
                <div class="dashboard-grid">
                    <div class="card summary-card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #667eea, #764ba2);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                        </div>
                        <div class="card-content">
                            <h3 id="total-receipts">0</h3>
                            <p>Total Receipts</p>
                        </div>
                        <div class="card-trend">
                            <span class="trend-up">â†— 12%</span>
                        </div>
                    </div>

                    <div class="card summary-card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #f093fb, #f5576c);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M12 1v22M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                            </svg>
                        </div>
                        <div class="card-content">
                            <h3 id="total-amount">$0</h3>
                            <p>Total Amount</p>
                        </div>
                        <div class="card-trend">
                            <span class="trend-up">â†— 8%</span>
                        </div>
                    </div>

                    <div class="card summary-card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #4facfe, #00f2fe);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                        </div>
                        <div class="card-content">
                            <h3 id="avg-amount">$0</h3>
                            <p>Average Receipt</p>
                        </div>
                        <div class="card-trend">
                            <span class="trend-down">â†˜ 5%</span>
                        </div>
                    </div>

                    <div class="card summary-card">
                        <div class="card-icon" style="background: linear-gradient(135deg, #43e97b, #38f9d7);">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                <circle cx="8.5" cy="7" r="4"></circle>
                                <line x1="20" y1="8" x2="20" y2="14"></line>
                                <line x1="23" y1="11" x2="17" y2="11"></line>
                            </svg>
                        </div>
                        <div class="card-content">
                            <h3 id="unique-merchants">0</h3>
                            <p>Merchants</p>
                        </div>
                        <div class="card-trend">
                            <span class="trend-up">â†— 15%</span>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="dashboard-grid charts-row">
                    <div class="card chart-card">
                        <div class="card-header">
                            <h3>Monthly Spending</h3>
                            <div class="card-actions">
                                <select id="time-range" class="select-small" onchange="updateTimeRange()">
                                    <option value="6">Last 6 months</option>
                                    <option value="12">Last 12 months</option>
                                    <option value="all">All time</option>
                                </select>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="spendingChart"></canvas>
                        </div>
                    </div>

                    <div class="card chart-card">
                        <div class="card-header">
                            <h3>Top Merchants</h3>
                            <div class="card-actions">
                                <button class="btn-icon-small" onclick="toggleChartView()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="1"></circle>
                                        <circle cx="12" cy="5" r="1"></circle>
                                        <circle cx="12" cy="19" r="1"></circle>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="merchantsChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Bottom Row -->
                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3>Payment Methods</h3>
                        </div>
                        <div class="payment-methods">
                            <div class="payment-method">
                                <div class="payment-icon cash">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="2" y="6" width="20" height="12" rx="2"></rect>
                                        <circle cx="12" cy="12" r="2"></circle>
                                        <path d="M6 12h.01M18 12h.01"></path>
                                    </svg>
                                </div>
                                <div class="payment-info">
                                    <span>Cash</span>
                                    <div class="payment-bar">
                                        <div class="bar-fill" id="cash-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <span class="payment-percent" id="cash-percent">0%</span>
                            </div>
                            <div class="payment-method">
                                <div class="payment-icon card">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                                        <line x1="1" y1="10" x2="23" y2="10"></line>
                                    </svg>
                                </div>
                                <div class="payment-info">
                                    <span>Card</span>
                                    <div class="payment-bar">
                                        <div class="bar-fill" id="card-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <span class="payment-percent" id="card-percent">0%</span>
                            </div>
                            <div class="payment-method">
                                <div class="payment-icon digital">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                        <path d="M8 21h8"></path>
                                        <path d="M12 17v4"></path>
                                    </svg>
                                </div>
                                <div class="payment-info">
                                    <span>Digital</span>
                                    <div class="payment-bar">
                                        <div class="bar-fill" id="digital-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                                <span class="payment-percent" id="digital-percent">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>Recent Receipts</h3>
                            <button class="btn-text" onclick="showAllReceipts()">View All</button>
                        </div>
                        <div class="receipts-list" id="recent-receipts">
                            <div class="empty-state">
                                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                <p>No receipts loaded. Click "Refresh Data" to load receipts.</p>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3>System Status</h3>
                        </div>
                        <div class="status-grid">
                            <div class="status-item">
                                <div class="status-indicator success" id="api-indicator"></div>
                                <span>API Connection</span>
                                <span class="status-value" id="api-status-value">Disconnected</span>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator" id="freshness-indicator"></div>
                                <span>Data Freshness</span>
                                <span class="status-value" id="data-freshness">Never</span>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator" id="storage-indicator"></div>
                                <span>Storage Used</span>
                                <span class="status-value" id="storage-used">0 MB</span>
                            </div>
                            <div class="status-item">
                                <div class="status-indicator success" id="token-indicator"></div>
                                <span>Session Status</span>
                                <span class="status-value" id="session-status">Active</span>
                            </div>
                        </div>
                        <div class="data-actions">
                            <button onclick="fetchReceipts()" class="btn btn-primary btn-sm" id="refresh-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21.5 2v6h-6M2.5 22v-6h6M2 11.5a10 10 0 0 1 18.8-4.3M22 12.5a10 10 0 0 1-18.8 4.2"></path>
                                </svg>
                                <span class="btn-text">Refresh Data</span>
                                <span class="spinner" id="refresh-spinner" style="display: none;"></span>
                            </button>
                            <button onclick="exportData()" class="btn btn-outline btn-sm">
                                Export CSV
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <footer class="app-footer">
                <p>Receipts Analytics Dashboard &copy; 2024 | Real-time Insights & Reporting</p>
                <div class="footer-links">
                    <span id="last-update">Last updated: Never</span>
                    <span id="data-count">0 receipts processed</span>
                </div>
            </footer>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script src="app.js"></script>
</body>
</html>